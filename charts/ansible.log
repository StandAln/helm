2023-01-29 21:13:06,266 p=5946 u=root n=ansible | PLAY [Remove web-app and db  from k8s] **************************************************************************************************************************************************************************************************
2023-01-29 21:13:06,280 p=5946 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 21:13:06,683 p=5961 u=root n=ansible | [WARNING]: Unhandled error in Python interpreter discovery for host centos: Failed to connect to the host via ssh: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password).

2023-01-29 21:13:06,753 p=5946 u=root n=ansible | fatal: [centos]: UNREACHABLE! => {"changed": false, "msg": "Data could not be sent to remote host \"192.168.0.153\". Make sure this host can be reached over ssh: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password).\r\n", "unreachable": true}
2023-01-29 21:13:06,754 p=5946 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:13:06,754 p=5946 u=root n=ansible | centos                     : ok=0    changed=0    unreachable=1    failed=0    skipped=0    rescued=0    ignored=0   
2023-01-29 21:14:01,109 p=6329 u=root n=ansible | PLAY [Remove web-app and db  from k8s] **************************************************************************************************************************************************************************************************
2023-01-29 21:14:01,118 p=6329 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 21:14:13,862 p=6329 u=root n=ansible | changed: [centos]
2023-01-29 21:14:13,866 p=6329 u=root n=ansible | TASK [remove python app] ****************************************************************************************************************************************************************************************************************
2023-01-29 21:14:14,451 p=6329 u=root n=ansible | changed: [centos]
2023-01-29 21:14:14,456 p=6329 u=root n=ansible | TASK [remove db app] ********************************************************************************************************************************************************************************************************************
2023-01-29 21:14:15,162 p=6329 u=root n=ansible | changed: [centos]
2023-01-29 21:14:15,164 p=6329 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:14:15,165 p=6329 u=root n=ansible | centos                     : ok=3    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2023-01-29 21:21:23,635 p=8320 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:21:23,644 p=8320 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:21:24,155 p=8320 u=root n=ansible | fatal: [centos]: FAILED! => {"ansible_facts": {"discovered_interpreter_python": "/usr/bin/python"}, "changed": true, "cmd": "helm --version", "delta": "0:00:00.033707", "end": "2023-01-29 21:21:24.137013", "msg": "non-zero return code", "rc": 1, "start": "2023-01-29 21:21:24.103306", "stderr": "Error: unknown flag: --version", "stderr_lines": ["Error: unknown flag: --version"], "stdout": "", "stdout_lines": []}
2023-01-29 21:21:24,156 p=8320 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:21:24,156 p=8320 u=root n=ansible | centos                     : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2023-01-29 21:22:09,161 p=8707 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:22:09,171 p=8707 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:22:09,578 p=8707 u=root n=ansible | changed: [centos]
2023-01-29 21:22:09,583 p=8707 u=root n=ansible | TASK [Install helm if not present] ******************************************************************************************************************************************************************************************************
2023-01-29 21:22:09,645 p=8707 u=root n=ansible | ok: [centos] => {
    "<type 'dict'>": "VARIABLE IS NOT DEFINED!"
}
2023-01-29 21:22:09,646 p=8707 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:22:09,647 p=8707 u=root n=ansible | centos                     : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2023-01-29 21:22:30,285 p=8889 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:22:30,295 p=8889 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:22:30,685 p=8889 u=root n=ansible | changed: [centos]
2023-01-29 21:22:30,689 p=8889 u=root n=ansible | TASK [Install helm if not present] ******************************************************************************************************************************************************************************************************
2023-01-29 21:22:30,723 p=8889 u=root n=ansible | ok: [centos] => {
    "helm_ver": {
        "ansible_facts": {
            "discovered_interpreter_python": "/usr/bin/python"
        }, 
        "changed": true, 
        "cmd": "helm version", 
        "delta": "0:00:00.029130", 
        "end": "2023-01-29 21:22:30.667895", 
        "failed": false, 
        "rc": 0, 
        "start": "2023-01-29 21:22:30.638765", 
        "stderr": "", 
        "stderr_lines": [], 
        "stdout": "version.BuildInfo{Version:\"v3.11.0\", GitCommit:\"472c5736ab01133de504a826bd9ee12cbe4e7904\", GitTreeState:\"clean\", GoVersion:\"go1.18.10\"}", 
        "stdout_lines": [
            "version.BuildInfo{Version:\"v3.11.0\", GitCommit:\"472c5736ab01133de504a826bd9ee12cbe4e7904\", GitTreeState:\"clean\", GoVersion:\"go1.18.10\"}"
        ]
    }
}
2023-01-29 21:22:30,725 p=8889 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:22:30,725 p=8889 u=root n=ansible | centos                     : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2023-01-29 21:23:00,252 p=9124 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:23:00,264 p=9124 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:23:01,238 p=9124 u=root n=ansible | fatal: [centos1]: FAILED! => {"ansible_facts": {"discovered_interpreter_python": "/usr/bin/python"}, "changed": true, "cmd": "helm version", "delta": "0:00:00.013476", "end": "2023-01-29 21:23:01.588396", "msg": "non-zero return code", "rc": 127, "start": "2023-01-29 21:23:01.574920", "stderr": "/bin/sh: helm: команда не найдена", "stderr_lines": ["/bin/sh: helm: команда не найдена"], "stdout": "", "stdout_lines": []}
2023-01-29 21:23:01,240 p=9124 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:23:01,240 p=9124 u=root n=ansible | centos1                    : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2023-01-29 21:24:49,496 p=9593 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:24:49,505 p=9593 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:24:50,057 p=9593 u=root n=ansible | changed: [centos1]
2023-01-29 21:24:50,061 p=9593 u=root n=ansible | TASK [Install helm if not present] ******************************************************************************************************************************************************************************************************
2023-01-29 21:24:50,100 p=9593 u=root n=ansible | ok: [centos1] => {
    "helm_ver": {
        "ansible_facts": {
            "discovered_interpreter_python": "/usr/bin/python"
        }, 
        "changed": true, 
        "cmd": "helm version", 
        "delta": "0:00:00.002694", 
        "end": "2023-01-29 21:24:50.408254", 
        "failed": false, 
        "failed_when_result": false, 
        "msg": "non-zero return code", 
        "rc": 127, 
        "start": "2023-01-29 21:24:50.405560", 
        "stderr": "/bin/sh: helm: команда не найдена", 
        "stderr_lines": [
            "/bin/sh: helm: команда не найдена"
        ], 
        "stdout": "", 
        "stdout_lines": []
    }
}
2023-01-29 21:24:50,102 p=9593 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:24:50,102 p=9593 u=root n=ansible | centos1                    : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2023-01-29 21:25:16,920 p=9769 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:25:16,930 p=9769 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:25:17,295 p=9769 u=root n=ansible | ok: [centos1]
2023-01-29 21:25:17,301 p=9769 u=root n=ansible | TASK [Install helm if not present] ******************************************************************************************************************************************************************************************************
2023-01-29 21:25:17,334 p=9769 u=root n=ansible | ok: [centos1] => {
    "helm_ver": {
        "ansible_facts": {
            "discovered_interpreter_python": "/usr/bin/python"
        }, 
        "changed": false, 
        "cmd": "helm version", 
        "delta": "0:00:00.002400", 
        "end": "2023-01-29 21:25:17.646584", 
        "failed": false, 
        "failed_when_result": false, 
        "msg": "non-zero return code", 
        "rc": 127, 
        "start": "2023-01-29 21:25:17.644184", 
        "stderr": "/bin/sh: helm: команда не найдена", 
        "stderr_lines": [
            "/bin/sh: helm: команда не найдена"
        ], 
        "stdout": "", 
        "stdout_lines": []
    }
}
2023-01-29 21:25:17,336 p=9769 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:25:17,337 p=9769 u=root n=ansible | centos1                    : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2023-01-29 21:25:32,593 p=9901 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:25:32,605 p=9901 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:25:33,193 p=9901 u=root n=ansible | ok: [centos]
2023-01-29 21:25:33,198 p=9901 u=root n=ansible | TASK [Install helm if not present] ******************************************************************************************************************************************************************************************************
2023-01-29 21:25:33,231 p=9901 u=root n=ansible | ok: [centos] => {
    "helm_ver": {
        "ansible_facts": {
            "discovered_interpreter_python": "/usr/bin/python"
        }, 
        "changed": false, 
        "cmd": "helm version", 
        "delta": "0:00:00.030665", 
        "end": "2023-01-29 21:25:33.166969", 
        "failed": false, 
        "failed_when_result": false, 
        "rc": 0, 
        "start": "2023-01-29 21:25:33.136304", 
        "stderr": "", 
        "stderr_lines": [], 
        "stdout": "version.BuildInfo{Version:\"v3.11.0\", GitCommit:\"472c5736ab01133de504a826bd9ee12cbe4e7904\", GitTreeState:\"clean\", GoVersion:\"go1.18.10\"}", 
        "stdout_lines": [
            "version.BuildInfo{Version:\"v3.11.0\", GitCommit:\"472c5736ab01133de504a826bd9ee12cbe4e7904\", GitTreeState:\"clean\", GoVersion:\"go1.18.10\"}"
        ]
    }
}
2023-01-29 21:25:33,234 p=9901 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:25:33,234 p=9901 u=root n=ansible | centos                     : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2023-01-29 21:26:52,194 p=10341 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:26:52,204 p=10341 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:26:52,743 p=10341 u=root n=ansible | ok: [centos]
2023-01-29 21:26:52,747 p=10341 u=root n=ansible | TASK [Install helm if not present] ******************************************************************************************************************************************************************************************************
2023-01-29 21:26:52,781 p=10341 u=root n=ansible | fatal: [centos]: FAILED! => {"msg": "The conditional check 'helm_ver.stderr is false' failed. The error was: template error while templating string: no test named 'false'. String: {% if helm_ver.stderr is false %} True {% else %} False {% endif %}\n\nThe error appears to be in '/opt/helm/charts/deploy_app.yml': line 16, column 7, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n\n    - name: Install helm if not present\n      ^ here\n"}
2023-01-29 21:26:52,782 p=10341 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:26:52,782 p=10341 u=root n=ansible | centos                     : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2023-01-29 21:27:12,954 p=10546 u=root n=ansible | ERROR! We were unable to read either as JSON nor YAML, these are the errors we got from each:
JSON: No JSON object could be decoded

Syntax Error while loading YAML.
  did not find expected key

The error appears to be in '/opt/helm/charts/deploy_app.yml': line 19, column 37, but may
be elsewhere in the file depending on the exact syntax problem.

The offending line appears to be:

        var: helm_ver
      when: "{{ helm_ver.stderr }}" is false
                                    ^ here
We could be wrong, but this one looks like it might be an issue with
missing quotes. Always quote template expression brackets when they
start a value. For instance:

    with_items:
      - {{ foo }}

Should be written as:

    with_items:
      - "{{ foo }}"

2023-01-29 21:27:22,073 p=10630 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:27:22,083 p=10630 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:27:22,494 p=10630 u=root n=ansible | ok: [centos]
2023-01-29 21:27:22,498 p=10630 u=root n=ansible | TASK [Install helm if not present] ******************************************************************************************************************************************************************************************************
2023-01-29 21:27:22,531 p=10630 u=root n=ansible | fatal: [centos]: FAILED! => {"msg": "The conditional check 'helm_ver.stderr is false' failed. The error was: template error while templating string: no test named 'false'. String: {% if helm_ver.stderr is false %} True {% else %} False {% endif %}\n\nThe error appears to be in '/opt/helm/charts/deploy_app.yml': line 16, column 7, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n\n    - name: Install helm if not present\n      ^ here\n"}
2023-01-29 21:27:22,532 p=10630 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:27:22,532 p=10630 u=root n=ansible | centos                     : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2023-01-29 21:28:20,329 p=10971 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:28:20,339 p=10971 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:28:20,741 p=10971 u=root n=ansible | ok: [centos]
2023-01-29 21:28:20,745 p=10971 u=root n=ansible | TASK [Install helm if not present] ******************************************************************************************************************************************************************************************************
2023-01-29 21:28:20,776 p=10971 u=root n=ansible | fatal: [centos]: FAILED! => {"msg": "The conditional check 'helm_ver.stderr >< \"\"' failed. The error was: template error while templating string: unexpected '<'. String: {% if helm_ver.stderr >< \"\" %} True {% else %} False {% endif %}\n\nThe error appears to be in '/opt/helm/charts/deploy_app.yml': line 16, column 7, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n\n    - name: Install helm if not present\n      ^ here\n"}
2023-01-29 21:28:20,777 p=10971 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:28:20,777 p=10971 u=root n=ansible | centos                     : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2023-01-29 21:29:40,755 p=11390 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:29:40,764 p=11390 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:29:41,277 p=11390 u=root n=ansible | ok: [centos]
2023-01-29 21:29:41,281 p=11390 u=root n=ansible | TASK [Install helm if not present] ******************************************************************************************************************************************************************************************************
2023-01-29 21:29:41,312 p=11390 u=root n=ansible | skipping: [centos]
2023-01-29 21:29:41,314 p=11390 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:29:41,314 p=11390 u=root n=ansible | centos                     : ok=1    changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
2023-01-29 21:29:48,581 p=11534 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:29:48,595 p=11534 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:29:49,109 p=11534 u=root n=ansible | ok: [centos1]
2023-01-29 21:29:49,112 p=11534 u=root n=ansible | TASK [Install helm if not present] ******************************************************************************************************************************************************************************************************
2023-01-29 21:29:49,149 p=11534 u=root n=ansible | ok: [centos1] => {
    "helm_ver": {
        "ansible_facts": {
            "discovered_interpreter_python": "/usr/bin/python"
        }, 
        "changed": false, 
        "cmd": "helm version", 
        "delta": "0:00:00.002626", 
        "end": "2023-01-29 21:29:49.457042", 
        "failed": false, 
        "failed_when_result": false, 
        "msg": "non-zero return code", 
        "rc": 127, 
        "start": "2023-01-29 21:29:49.454416", 
        "stderr": "/bin/sh: helm: команда не найдена", 
        "stderr_lines": [
            "/bin/sh: helm: команда не найдена"
        ], 
        "stdout": "", 
        "stdout_lines": []
    }
}
2023-01-29 21:29:49,151 p=11534 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:29:49,151 p=11534 u=root n=ansible | centos1                    : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2023-01-29 21:42:27,059 p=14474 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:42:27,069 p=14474 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:42:27,576 p=14474 u=root n=ansible | ok: [centos1]
2023-01-29 21:42:27,581 p=14474 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 21:42:30,069 p=14474 u=root n=ansible | [WARNING]: Module remote_tmp /root/.ansible/tmp did not exist and was created with a mode of 0700, this may cause issues when running as another user. To avoid this, create the remote_tmp dir with the correct permissions manually

2023-01-29 21:42:30,070 p=14474 u=root n=ansible | fatal: [centos1]: FAILED! => {"ansible_facts": {"pkg_mgr": "yum"}, "changed": false, "msg": "Failed to get nevra information from RPM package: https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3"}
2023-01-29 21:42:30,071 p=14474 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:42:30,071 p=14474 u=root n=ansible | centos1                    : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2023-01-29 21:43:43,739 p=14885 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:43:43,749 p=14885 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:43:44,416 p=14885 u=root n=ansible | ok: [centos1]
2023-01-29 21:43:44,419 p=14885 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 21:43:45,772 p=14885 u=root n=ansible | fatal: [centos1]: FAILED! => {"ansible_facts": {"pkg_mgr": "yum"}, "changed": false, "msg": "Failed to get nevra information from RPM package: https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3"}
2023-01-29 21:43:45,775 p=14885 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:43:45,775 p=14885 u=root n=ansible | centos1                    : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2023-01-29 21:44:17,038 p=15104 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:44:17,047 p=15104 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:44:17,428 p=15104 u=root n=ansible | ok: [centos1]
2023-01-29 21:44:17,433 p=15104 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 21:44:18,748 p=15104 u=root n=ansible | fatal: [centos1]: FAILED! => {"ansible_facts": {"pkg_mgr": "yum"}, "changed": false, "msg": "Failed to get nevra information from RPM package: https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3"}
2023-01-29 21:44:18,749 p=15104 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:44:18,749 p=15104 u=root n=ansible | centos1                    : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2023-01-29 21:46:41,158 p=15738 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:46:41,169 p=15738 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:46:41,617 p=15738 u=root n=ansible | ok: [centos1]
2023-01-29 21:46:41,621 p=15738 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 21:46:42,169 p=15738 u=root n=ansible | changed: [centos1]
2023-01-29 21:46:42,172 p=15738 u=root n=ansible | TASK [chmod helm.sh] ********************************************************************************************************************************************************************************************************************
2023-01-29 21:46:42,367 p=15738 u=root n=ansible | [WARNING]: Consider using the file module with mode rather than running 'chmod'.  If you need to use command because file is insufficient you can add 'warn: false' to this command task or set 'command_warnings=False' in ansible.cfg
to get rid of this message.

2023-01-29 21:46:42,367 p=15738 u=root n=ansible | fatal: [centos1]: FAILED! => {"changed": true, "cmd": "chmod 700 /root/get_helm.sh", "delta": "0:00:00.033716", "end": "2023-01-29 21:46:42.720500", "msg": "non-zero return code", "rc": 1, "start": "2023-01-29 21:46:42.686784", "stderr": "chmod: невозможно получить доступ к «/root/get_helm.sh»: Нет такого файла или каталога", "stderr_lines": ["chmod: невозможно получить доступ к «/root/get_helm.sh»: Нет такого файла или каталога"], "stdout": "", "stdout_lines": []}
2023-01-29 21:46:42,368 p=15738 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:46:42,369 p=15738 u=root n=ansible | centos1                    : ok=2    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2023-01-29 21:47:44,655 p=16045 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:47:44,665 p=16045 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:47:45,134 p=16045 u=root n=ansible | ok: [centos1]
2023-01-29 21:47:45,138 p=16045 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 21:47:45,716 p=16045 u=root n=ansible | ok: [centos1]
2023-01-29 21:47:45,719 p=16045 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 21:47:45,890 p=16045 u=root n=ansible | fatal: [centos1]: FAILED! => {"changed": true, "cmd": "/root/get_helm.sh", "delta": "0:00:00.002440", "end": "2023-01-29 21:47:46.244629", "msg": "non-zero return code", "rc": 127, "start": "2023-01-29 21:47:46.242189", "stderr": "/bin/sh: /root/get_helm.sh: Нет такого файла или каталога", "stderr_lines": ["/bin/sh: /root/get_helm.sh: Нет такого файла или каталога"], "stdout": "", "stdout_lines": []}
2023-01-29 21:47:45,891 p=16045 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:47:45,891 p=16045 u=root n=ansible | centos1                    : ok=2    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2023-01-29 21:48:07,059 p=16270 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:48:07,068 p=16270 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:48:07,398 p=16270 u=root n=ansible | ok: [centos1]
2023-01-29 21:48:07,401 p=16270 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 21:48:07,987 p=16270 u=root n=ansible | ok: [centos1]
2023-01-29 21:48:07,989 p=16270 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 21:48:08,160 p=16270 u=root n=ansible | fatal: [centos1]: FAILED! => {"changed": true, "cmd": "/root/get_helm", "delta": "0:00:00.002342", "end": "2023-01-29 21:48:08.514451", "msg": "non-zero return code", "rc": 127, "start": "2023-01-29 21:48:08.512109", "stderr": "/bin/sh: /root/get_helm: Нет такого файла или каталога", "stderr_lines": ["/bin/sh: /root/get_helm: Нет такого файла или каталога"], "stdout": "", "stdout_lines": []}
2023-01-29 21:48:08,161 p=16270 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:48:08,162 p=16270 u=root n=ansible | centos1                    : ok=2    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2023-01-29 21:48:28,894 p=16447 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:48:28,904 p=16447 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:48:29,225 p=16447 u=root n=ansible | ok: [centos1]
2023-01-29 21:48:29,229 p=16447 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 21:48:29,809 p=16447 u=root n=ansible | ok: [centos1]
2023-01-29 21:48:29,812 p=16447 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 21:48:29,976 p=16447 u=root n=ansible | fatal: [centos1]: FAILED! => {"changed": true, "cmd": "/root/get-helm-3", "delta": "0:00:00.002311", "end": "2023-01-29 21:48:30.332408", "msg": "non-zero return code", "rc": 126, "start": "2023-01-29 21:48:30.330097", "stderr": "/bin/sh: /root/get-helm-3: Отказано в доступе", "stderr_lines": ["/bin/sh: /root/get-helm-3: Отказано в доступе"], "stdout": "", "stdout_lines": []}
2023-01-29 21:48:29,978 p=16447 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:48:29,978 p=16447 u=root n=ansible | centos1                    : ok=2    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2023-01-29 21:48:49,876 p=16617 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:48:49,886 p=16617 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:48:49,923 p=16617 u=root n=ansible |  [ERROR]: User interrupted execution

2023-01-29 21:48:51,849 p=16676 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:48:51,862 p=16676 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:48:52,251 p=16676 u=root n=ansible | ok: [centos1]
2023-01-29 21:48:52,254 p=16676 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 21:48:52,930 p=16676 u=root n=ansible | ok: [centos1]
2023-01-29 21:48:52,933 p=16676 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 21:49:00,952 p=16676 u=root n=ansible | fatal: [centos1]: FAILED! => {"changed": true, "cmd": "bash /root/get-helm-3", "delta": "0:00:07.844234", "end": "2023-01-29 21:49:01.305159", "msg": "non-zero return code", "rc": 1, "start": "2023-01-29 21:48:53.460925", "stderr": "", "stderr_lines": [], "stdout": "[WARNING] Could not find git. It is required for plugin installation.\nDownloading https://get.helm.sh/helm-v3.11.0-linux-amd64.tar.gz\nVerifying checksum... Done.\nPreparing to install helm into /usr/local/bin\nhelm installed into /usr/local/bin/helm\nhelm not found. Is /usr/local/bin on your $PATH?\nFailed to install helm\n\tFor support, go to https://github.com/helm/helm.", "stdout_lines": ["[WARNING] Could not find git. It is required for plugin installation.", "Downloading https://get.helm.sh/helm-v3.11.0-linux-amd64.tar.gz", "Verifying checksum... Done.", "Preparing to install helm into /usr/local/bin", "helm installed into /usr/local/bin/helm", "helm not found. Is /usr/local/bin on your $PATH?", "Failed to install helm", "\tFor support, go to https://github.com/helm/helm."]}
2023-01-29 21:49:00,953 p=16676 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:49:00,954 p=16676 u=root n=ansible | centos1                    : ok=2    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2023-01-29 21:50:47,031 p=17226 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:50:47,040 p=17226 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:50:47,524 p=17226 u=root n=ansible | ok: [centos1]
2023-01-29 21:50:47,528 p=17226 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 21:50:48,096 p=17226 u=root n=ansible | ok: [centos1]
2023-01-29 21:50:48,099 p=17226 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 21:50:52,556 p=17226 u=root n=ansible | fatal: [centos1]: FAILED! => {"changed": true, "cmd": "bash /root/get-helm-3", "delta": "0:00:04.294936", "end": "2023-01-29 21:50:52.908681", "msg": "non-zero return code", "rc": 1, "start": "2023-01-29 21:50:48.613745", "stderr": "", "stderr_lines": [], "stdout": "[WARNING] Could not find git. It is required for plugin installation.\nDownloading https://get.helm.sh/helm-v3.11.0-linux-amd64.tar.gz\nVerifying checksum... Done.\nPreparing to install helm into /usr/local/bin\nhelm installed into /usr/local/bin/helm\nhelm not found. Is /usr/local/bin on your $PATH?\nFailed to install helm\n\tFor support, go to https://github.com/helm/helm.", "stdout_lines": ["[WARNING] Could not find git. It is required for plugin installation.", "Downloading https://get.helm.sh/helm-v3.11.0-linux-amd64.tar.gz", "Verifying checksum... Done.", "Preparing to install helm into /usr/local/bin", "helm installed into /usr/local/bin/helm", "helm not found. Is /usr/local/bin on your $PATH?", "Failed to install helm", "\tFor support, go to https://github.com/helm/helm."]}
2023-01-29 21:50:52,557 p=17226 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:50:52,557 p=17226 u=root n=ansible | centos1                    : ok=2    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2023-01-29 21:53:36,415 p=17962 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:53:36,425 p=17962 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:53:36,880 p=17962 u=root n=ansible | ok: [centos1]
2023-01-29 21:53:36,884 p=17962 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 21:53:37,426 p=17962 u=root n=ansible | ok: [centos1]
2023-01-29 21:53:37,429 p=17962 u=root n=ansible | TASK [install git] **********************************************************************************************************************************************************************************************************************
2023-01-29 21:53:49,533 p=17962 u=root n=ansible | changed: [centos1]
2023-01-29 21:53:49,536 p=17962 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 21:53:53,908 p=17962 u=root n=ansible | fatal: [centos1]: FAILED! => {"changed": true, "cmd": "bash /root/get-helm-3", "delta": "0:00:04.199336", "end": "2023-01-29 21:53:54.257519", "msg": "non-zero return code", "rc": 1, "start": "2023-01-29 21:53:50.058183", "stderr": "", "stderr_lines": [], "stdout": "Downloading https://get.helm.sh/helm-v3.11.0-linux-amd64.tar.gz\nVerifying checksum... Done.\nPreparing to install helm into /usr/local/bin\nhelm installed into /usr/local/bin/helm\nhelm not found. Is /usr/local/bin on your $PATH?\nFailed to install helm\n\tFor support, go to https://github.com/helm/helm.", "stdout_lines": ["Downloading https://get.helm.sh/helm-v3.11.0-linux-amd64.tar.gz", "Verifying checksum... Done.", "Preparing to install helm into /usr/local/bin", "helm installed into /usr/local/bin/helm", "helm not found. Is /usr/local/bin on your $PATH?", "Failed to install helm", "\tFor support, go to https://github.com/helm/helm."]}
2023-01-29 21:53:53,909 p=17962 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:53:53,909 p=17962 u=root n=ansible | centos1                    : ok=3    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2023-01-29 21:59:29,559 p=19437 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:59:29,569 p=19437 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:59:30,041 p=19437 u=root n=ansible | ok: [centos1]
2023-01-29 21:59:30,044 p=19437 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 21:59:30,597 p=19437 u=root n=ansible | ok: [centos1]
2023-01-29 21:59:30,600 p=19437 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 21:59:36,435 p=19437 u=root n=ansible | changed: [centos1]
2023-01-29 21:59:36,437 p=19437 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:59:36,437 p=19437 u=root n=ansible | centos1                    : ok=3    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2023-01-29 21:59:52,882 p=19647 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 21:59:52,893 p=19647 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 21:59:53,232 p=19647 u=root n=ansible | ok: [centos1]
2023-01-29 21:59:53,236 p=19647 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 21:59:53,788 p=19647 u=root n=ansible | ok: [centos1]
2023-01-29 21:59:53,790 p=19647 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 21:59:55,125 p=19647 u=root n=ansible | changed: [centos1]
2023-01-29 21:59:55,127 p=19647 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 21:59:55,127 p=19647 u=root n=ansible | centos1                    : ok=3    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2023-01-29 22:00:14,198 p=19826 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 22:00:14,208 p=19826 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 22:00:14,537 p=19826 u=root n=ansible | ok: [centos1]
2023-01-29 22:00:14,540 p=19826 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:00:15,586 p=19826 u=root n=ansible | ok: [centos1]
2023-01-29 22:00:15,589 p=19826 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 22:00:19,817 p=19826 u=root n=ansible | ok: [centos1]
2023-01-29 22:00:19,819 p=19826 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:00:19,820 p=19826 u=root n=ansible | centos1                    : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2023-01-29 22:09:33,083 p=22143 u=root n=ansible | PLAY [Remove web-app and db  from k8s] **************************************************************************************************************************************************************************************************
2023-01-29 22:09:33,093 p=22143 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:09:33,494 p=22143 u=root n=ansible | changed: [localhost]
2023-01-29 22:09:33,504 p=22143 u=root n=ansible | TASK [remove python app] ****************************************************************************************************************************************************************************************************************
2023-01-29 22:09:33,733 p=22143 u=root n=ansible | fatal: [localhost]: FAILED! => {"changed": true, "cmd": "helm delete python", "delta": "0:00:00.031535", "end": "2023-01-29 22:09:33.719500", "msg": "non-zero return code", "rc": 1, "start": "2023-01-29 22:09:33.687965", "stderr": "Error: uninstall: Release not loaded: python: release: not found", "stderr_lines": ["Error: uninstall: Release not loaded: python: release: not found"], "stdout": "", "stdout_lines": []}
2023-01-29 22:09:33,734 p=22143 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:09:33,734 p=22143 u=root n=ansible | localhost                  : ok=1    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2023-01-29 22:12:28,310 p=22887 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 22:12:28,321 p=22887 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 22:12:28,591 p=22887 u=root n=ansible | ok: [localhost]
2023-01-29 22:12:28,595 p=22887 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:12:28,626 p=22887 u=root n=ansible | skipping: [localhost]
2023-01-29 22:12:28,629 p=22887 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 22:12:28,658 p=22887 u=root n=ansible | skipping: [localhost]
2023-01-29 22:12:28,662 p=22887 u=root n=ansible | TASK [install ingres-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:12:29,549 p=22887 u=root n=ansible | changed: [localhost]
2023-01-29 22:12:29,552 p=22887 u=root n=ansible | TASK [install postgres] *****************************************************************************************************************************************************************************************************************
2023-01-29 22:12:30,892 p=22887 u=root n=ansible | changed: [localhost]
2023-01-29 22:12:30,895 p=22887 u=root n=ansible | TASK [install python app] ***************************************************************************************************************************************************************************************************************
2023-01-29 22:12:31,234 p=22887 u=root n=ansible | fatal: [localhost]: FAILED! => {"changed": true, "cmd": "helm install postgres pythweb/", "delta": "0:00:00.215952", "end": "2023-01-29 22:12:31.217784", "msg": "non-zero return code", "rc": 1, "start": "2023-01-29 22:12:31.001832", "stderr": "Error: INSTALLATION FAILED: cannot re-use a name that is still in use", "stderr_lines": ["Error: INSTALLATION FAILED: cannot re-use a name that is still in use"], "stdout": "", "stdout_lines": []}
2023-01-29 22:12:31,236 p=22887 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:12:31,236 p=22887 u=root n=ansible | localhost                  : ok=3    changed=2    unreachable=0    failed=1    skipped=2    rescued=0    ignored=0   
2023-01-29 22:12:47,747 p=23249 u=root n=ansible | PLAY [Remove web-app and db  from k8s] **************************************************************************************************************************************************************************************************
2023-01-29 22:12:47,758 p=23249 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:12:59,843 p=23249 u=root n=ansible | changed: [localhost]
2023-01-29 22:12:59,846 p=23249 u=root n=ansible | TASK [Check installed charts] ***********************************************************************************************************************************************************************************************************
2023-01-29 22:13:00,059 p=23249 u=root n=ansible | ok: [localhost]
2023-01-29 22:13:00,063 p=23249 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:13:00,104 p=23249 u=root n=ansible | ok: [localhost] => {
    "helm_list": {
        "changed": false, 
        "cmd": "helm list", 
        "delta": "0:00:00.038588", 
        "end": "2023-01-29 22:13:00.042473", 
        "failed": false, 
        "failed_when_result": false, 
        "rc": 0, 
        "start": "2023-01-29 22:13:00.003885", 
        "stderr": "", 
        "stderr_lines": [], 
        "stdout": "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION\npostgres\tdefault  \t1       \t2023-01-29 22:12:29.803838581 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     ", 
        "stdout_lines": [
            "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION", 
            "postgres\tdefault  \t1       \t2023-01-29 22:12:29.803838581 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     "
        ]
    }
}
2023-01-29 22:13:00,106 p=23249 u=root n=ansible | TASK [remove python app] ****************************************************************************************************************************************************************************************************************
2023-01-29 22:13:00,326 p=23249 u=root n=ansible | fatal: [localhost]: FAILED! => {"changed": true, "cmd": "helm delete python", "delta": "0:00:00.030924", "end": "2023-01-29 22:13:00.310690", "msg": "non-zero return code", "rc": 1, "start": "2023-01-29 22:13:00.279766", "stderr": "Error: uninstall: Release not loaded: python: release: not found", "stderr_lines": ["Error: uninstall: Release not loaded: python: release: not found"], "stdout": "", "stdout_lines": []}
2023-01-29 22:13:00,327 p=23249 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:13:00,328 p=23249 u=root n=ansible | localhost                  : ok=3    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2023-01-29 22:14:33,603 p=23883 u=root n=ansible | PLAY [Remove web-app and db  from k8s] **************************************************************************************************************************************************************************************************
2023-01-29 22:14:33,623 p=23883 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:14:34,001 p=23883 u=root n=ansible | changed: [localhost]
2023-01-29 22:14:34,004 p=23883 u=root n=ansible | TASK [Check installed charts] ***********************************************************************************************************************************************************************************************************
2023-01-29 22:14:34,231 p=23883 u=root n=ansible | ok: [localhost]
2023-01-29 22:14:34,233 p=23883 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:14:34,265 p=23883 u=root n=ansible | ok: [localhost] => {
    "helm_list": {
        "changed": false, 
        "cmd": "helm list", 
        "delta": "0:00:00.032055", 
        "end": "2023-01-29 22:14:34.214659", 
        "failed": false, 
        "failed_when_result": false, 
        "rc": 0, 
        "start": "2023-01-29 22:14:34.182604", 
        "stderr": "", 
        "stderr_lines": [], 
        "stdout": "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION\npostgres\tdefault  \t1       \t2023-01-29 22:12:29.803838581 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     ", 
        "stdout_lines": [
            "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION", 
            "postgres\tdefault  \t1       \t2023-01-29 22:12:29.803838581 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     "
        ]
    }
}
2023-01-29 22:14:34,271 p=23883 u=root n=ansible | TASK [remove python app] ****************************************************************************************************************************************************************************************************************
2023-01-29 22:14:34,305 p=23883 u=root n=ansible | fatal: [localhost]: FAILED! => {"msg": "The conditional check 'python in helm_list' failed. The error was: error while evaluating conditional (python in helm_list): 'python' is undefined\n\nThe error appears to be in '/opt/helm/charts/remove_app.yml': line 24, column 7, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n\n    - name: remove python app\n      ^ here\n"}
2023-01-29 22:14:34,306 p=23883 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:14:34,306 p=23883 u=root n=ansible | localhost                  : ok=3    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2023-01-29 22:15:05,253 p=24084 u=root n=ansible | PLAY [Remove web-app and db  from k8s] **************************************************************************************************************************************************************************************************
2023-01-29 22:15:05,263 p=24084 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:15:05,650 p=24084 u=root n=ansible | changed: [localhost]
2023-01-29 22:15:05,654 p=24084 u=root n=ansible | TASK [Check installed charts] ***********************************************************************************************************************************************************************************************************
2023-01-29 22:15:05,855 p=24084 u=root n=ansible | ok: [localhost]
2023-01-29 22:15:05,858 p=24084 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:15:05,888 p=24084 u=root n=ansible | ok: [localhost] => {
    "helm_list": {
        "changed": false, 
        "cmd": "helm list", 
        "delta": "0:00:00.032998", 
        "end": "2023-01-29 22:15:05.839262", 
        "failed": false, 
        "failed_when_result": false, 
        "rc": 0, 
        "start": "2023-01-29 22:15:05.806264", 
        "stderr": "", 
        "stderr_lines": [], 
        "stdout": "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION\npostgres\tdefault  \t1       \t2023-01-29 22:12:29.803838581 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     ", 
        "stdout_lines": [
            "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION", 
            "postgres\tdefault  \t1       \t2023-01-29 22:12:29.803838581 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     "
        ]
    }
}
2023-01-29 22:15:05,890 p=24084 u=root n=ansible | TASK [remove python app] ****************************************************************************************************************************************************************************************************************
2023-01-29 22:15:05,921 p=24084 u=root n=ansible | fatal: [localhost]: FAILED! => {"msg": "The conditional check 'python in helm_list.stdout' failed. The error was: error while evaluating conditional (python in helm_list.stdout): Unable to look up a name or access an attribute in template string ({% if python in helm_list.stdout %} True {% else %} False {% endif %}).\nMake sure your variable name does not contain invalid characters like '-': coercing to Unicode: need string or buffer, AnsibleUndefined found\n\nThe error appears to be in '/opt/helm/charts/remove_app.yml': line 24, column 7, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n\n    - name: remove python app\n      ^ here\n"}
2023-01-29 22:15:05,922 p=24084 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:15:05,922 p=24084 u=root n=ansible | localhost                  : ok=3    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2023-01-29 22:16:59,933 p=24600 u=root n=ansible | ERROR! We were unable to read either as JSON nor YAML, these are the errors we got from each:
JSON: No JSON object could be decoded

Syntax Error while loading YAML.
  did not find expected key

The error appears to be in '/opt/helm/charts/remove_app.yml': line 27, column 22, but may
be elsewhere in the file depending on the exact syntax problem.

The offending line appears to be:

        cmd: helm delete python
      when: 'python' in helm_list.stdout
                     ^ here
This one looks easy to fix. It seems that there is a value started
with a quote, and the YAML parser is expecting to see the line ended
with the same kind of quote. For instance:

    when: "ok" in result.stdout

Could be written as:

   when: '"ok" in result.stdout'

Or equivalently:

   when: "'ok' in result.stdout"

2023-01-29 22:18:24,340 p=24978 u=root n=ansible | PLAY [Remove web-app and db  from k8s] **************************************************************************************************************************************************************************************************
2023-01-29 22:18:24,349 p=24978 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:18:24,724 p=24978 u=root n=ansible | changed: [localhost]
2023-01-29 22:18:24,728 p=24978 u=root n=ansible | TASK [Check installed charts] ***********************************************************************************************************************************************************************************************************
2023-01-29 22:18:24,942 p=24978 u=root n=ansible | ok: [localhost]
2023-01-29 22:18:24,945 p=24978 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:18:24,980 p=24978 u=root n=ansible | ok: [localhost] => {
    "helm_list": {
        "changed": false, 
        "cmd": "helm list", 
        "delta": "0:00:00.031387", 
        "end": "2023-01-29 22:18:24.926296", 
        "failed": false, 
        "failed_when_result": false, 
        "rc": 0, 
        "start": "2023-01-29 22:18:24.894909", 
        "stderr": "", 
        "stderr_lines": [], 
        "stdout": "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION\npostgres\tdefault  \t1       \t2023-01-29 22:12:29.803838581 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     ", 
        "stdout_lines": [
            "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION", 
            "postgres\tdefault  \t1       \t2023-01-29 22:12:29.803838581 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     "
        ]
    }
}
2023-01-29 22:18:24,983 p=24978 u=root n=ansible | TASK [remove python app] ****************************************************************************************************************************************************************************************************************
2023-01-29 22:18:25,025 p=24978 u=root n=ansible | fatal: [localhost]: FAILED! => {"msg": "The conditional check 'python in helm_list.stdout' failed. The error was: error while evaluating conditional (python in helm_list.stdout): Unable to look up a name or access an attribute in template string ({% if python in helm_list.stdout %} True {% else %} False {% endif %}).\nMake sure your variable name does not contain invalid characters like '-': coercing to Unicode: need string or buffer, AnsibleUndefined found\n\nThe error appears to be in '/opt/helm/charts/remove_app.yml': line 24, column 7, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n\n    - name: remove python app\n      ^ here\n"}
2023-01-29 22:18:25,026 p=24978 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:18:25,026 p=24978 u=root n=ansible | localhost                  : ok=3    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2023-01-29 22:20:02,170 p=25420 u=root n=ansible | PLAY [Remove web-app and db  from k8s] **************************************************************************************************************************************************************************************************
2023-01-29 22:20:02,179 p=25420 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:20:02,557 p=25420 u=root n=ansible | changed: [localhost]
2023-01-29 22:20:02,560 p=25420 u=root n=ansible | TASK [Check installed charts] ***********************************************************************************************************************************************************************************************************
2023-01-29 22:20:02,762 p=25420 u=root n=ansible | ok: [localhost]
2023-01-29 22:20:02,766 p=25420 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:20:02,803 p=25420 u=root n=ansible | ok: [localhost] => {
    "helm_list": {
        "changed": false, 
        "cmd": "helm list", 
        "delta": "0:00:00.032847", 
        "end": "2023-01-29 22:20:02.746841", 
        "failed": false, 
        "failed_when_result": false, 
        "rc": 0, 
        "start": "2023-01-29 22:20:02.713994", 
        "stderr": "", 
        "stderr_lines": [], 
        "stdout": "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION\npostgres\tdefault  \t1       \t2023-01-29 22:12:29.803838581 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     ", 
        "stdout_lines": [
            "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION", 
            "postgres\tdefault  \t1       \t2023-01-29 22:12:29.803838581 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     "
        ]
    }
}
2023-01-29 22:20:02,806 p=25420 u=root n=ansible | TASK [remove python app] ****************************************************************************************************************************************************************************************************************
2023-01-29 22:20:02,840 p=25420 u=root n=ansible | skipping: [localhost]
2023-01-29 22:20:02,843 p=25420 u=root n=ansible | TASK [remove db app] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:20:03,269 p=25420 u=root n=ansible | changed: [localhost]
2023-01-29 22:20:03,271 p=25420 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:20:03,272 p=25420 u=root n=ansible | localhost                  : ok=4    changed=2    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
2023-01-29 22:21:07,767 p=25813 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 22:21:07,776 p=25813 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 22:21:08,104 p=25813 u=root n=ansible | ok: [localhost]
2023-01-29 22:21:08,107 p=25813 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:21:08,141 p=25813 u=root n=ansible | skipping: [localhost]
2023-01-29 22:21:08,144 p=25813 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 22:21:08,171 p=25813 u=root n=ansible | skipping: [localhost]
2023-01-29 22:21:08,174 p=25813 u=root n=ansible | TASK [install ingres-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:21:08,766 p=25813 u=root n=ansible | changed: [localhost]
2023-01-29 22:21:08,769 p=25813 u=root n=ansible | TASK [install postgres] *****************************************************************************************************************************************************************************************************************
2023-01-29 22:21:09,103 p=25813 u=root n=ansible | changed: [localhost]
2023-01-29 22:21:09,106 p=25813 u=root n=ansible | TASK [install python app] ***************************************************************************************************************************************************************************************************************
2023-01-29 22:21:09,447 p=25813 u=root n=ansible | fatal: [localhost]: FAILED! => {"changed": true, "cmd": "helm install postgres pythweb/", "delta": "0:00:00.214888", "end": "2023-01-29 22:21:09.431239", "msg": "non-zero return code", "rc": 1, "start": "2023-01-29 22:21:09.216351", "stderr": "Error: INSTALLATION FAILED: cannot re-use a name that is still in use", "stderr_lines": ["Error: INSTALLATION FAILED: cannot re-use a name that is still in use"], "stdout": "", "stdout_lines": []}
2023-01-29 22:21:09,453 p=25813 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:21:09,453 p=25813 u=root n=ansible | localhost                  : ok=3    changed=2    unreachable=0    failed=1    skipped=2    rescued=0    ignored=0   
2023-01-29 22:21:41,822 p=26275 u=root n=ansible | PLAY [Remove web-app and db  from k8s] **************************************************************************************************************************************************************************************************
2023-01-29 22:21:41,832 p=26275 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:21:54,023 p=26275 u=root n=ansible | changed: [localhost]
2023-01-29 22:21:54,027 p=26275 u=root n=ansible | TASK [Check installed charts] ***********************************************************************************************************************************************************************************************************
2023-01-29 22:21:54,247 p=26275 u=root n=ansible | ok: [localhost]
2023-01-29 22:21:54,250 p=26275 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:21:54,280 p=26275 u=root n=ansible | ok: [localhost] => {
    "helm_list": {
        "changed": false, 
        "cmd": "helm list", 
        "delta": "0:00:00.033395", 
        "end": "2023-01-29 22:21:54.231667", 
        "failed": false, 
        "failed_when_result": false, 
        "rc": 0, 
        "start": "2023-01-29 22:21:54.198272", 
        "stderr": "", 
        "stderr_lines": [], 
        "stdout": "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION\npostgres\tdefault  \t1       \t2023-01-29 22:21:08.926759516 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     ", 
        "stdout_lines": [
            "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION", 
            "postgres\tdefault  \t1       \t2023-01-29 22:21:08.926759516 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     "
        ]
    }
}
2023-01-29 22:21:54,282 p=26275 u=root n=ansible | TASK [remove python app] ****************************************************************************************************************************************************************************************************************
2023-01-29 22:21:54,310 p=26275 u=root n=ansible | skipping: [localhost]
2023-01-29 22:21:54,312 p=26275 u=root n=ansible | TASK [remove db app] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:21:54,719 p=26275 u=root n=ansible | changed: [localhost]
2023-01-29 22:21:54,722 p=26275 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:21:54,722 p=26275 u=root n=ansible | localhost                  : ok=4    changed=2    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
2023-01-29 22:21:58,885 p=26618 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 22:21:58,894 p=26618 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 22:21:59,168 p=26618 u=root n=ansible | ok: [localhost]
2023-01-29 22:21:59,171 p=26618 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:21:59,200 p=26618 u=root n=ansible | skipping: [localhost]
2023-01-29 22:21:59,203 p=26618 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 22:21:59,232 p=26618 u=root n=ansible | skipping: [localhost]
2023-01-29 22:21:59,234 p=26618 u=root n=ansible | TASK [install ingres-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:21:59,827 p=26618 u=root n=ansible | changed: [localhost]
2023-01-29 22:21:59,830 p=26618 u=root n=ansible | TASK [install postgres] *****************************************************************************************************************************************************************************************************************
2023-01-29 22:22:00,829 p=26618 u=root n=ansible | changed: [localhost]
2023-01-29 22:22:00,831 p=26618 u=root n=ansible | TASK [install python app] ***************************************************************************************************************************************************************************************************************
2023-01-29 22:22:02,714 p=26618 u=root n=ansible | fatal: [localhost]: FAILED! => {"changed": true, "cmd": "helm install python pythweb/", "delta": "0:00:01.755060", "end": "2023-01-29 22:22:02.692920", "msg": "non-zero return code", "rc": 1, "start": "2023-01-29 22:22:00.937860", "stderr": "Error: INSTALLATION FAILED: Internal error occurred: failed calling webhook \"validate.nginx.ingress.kubernetes.io\": failed to call webhook: Post \"https://ingress-nginx-controller-admission.ingress-nginx.svc:443/networking/v1/ingresses?timeout=10s\": dial tcp 10.107.137.58:443: connect: connection refused", "stderr_lines": ["Error: INSTALLATION FAILED: Internal error occurred: failed calling webhook \"validate.nginx.ingress.kubernetes.io\": failed to call webhook: Post \"https://ingress-nginx-controller-admission.ingress-nginx.svc:443/networking/v1/ingresses?timeout=10s\": dial tcp 10.107.137.58:443: connect: connection refused"], "stdout": "", "stdout_lines": []}
2023-01-29 22:22:02,720 p=26618 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:22:02,720 p=26618 u=root n=ansible | localhost                  : ok=3    changed=2    unreachable=0    failed=1    skipped=2    rescued=0    ignored=0   
2023-01-29 22:24:14,077 p=27562 u=root n=ansible | PLAY [Remove web-app and db  from k8s] **************************************************************************************************************************************************************************************************
2023-01-29 22:24:14,087 p=27562 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:24:26,693 p=27562 u=root n=ansible | changed: [localhost]
2023-01-29 22:24:26,696 p=27562 u=root n=ansible | TASK [Check installed charts] ***********************************************************************************************************************************************************************************************************
2023-01-29 22:24:26,931 p=27562 u=root n=ansible | ok: [localhost]
2023-01-29 22:24:26,936 p=27562 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:24:26,969 p=27562 u=root n=ansible | ok: [localhost] => {
    "helm_list": {
        "changed": false, 
        "cmd": "helm list", 
        "delta": "0:00:00.036314", 
        "end": "2023-01-29 22:24:26.910984", 
        "failed": false, 
        "failed_when_result": false, 
        "rc": 0, 
        "start": "2023-01-29 22:24:26.874670", 
        "stderr": "", 
        "stderr_lines": [], 
        "stdout": "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION\npostgres\tdefault  \t1       \t2023-01-29 22:22:00.009247987 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     \npython  \tdefault  \t1       \t2023-01-29 22:22:01.169234597 +0300 MSK\tfailed  \tpython-0.1.0   \t1.16.0     ", 
        "stdout_lines": [
            "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION", 
            "postgres\tdefault  \t1       \t2023-01-29 22:22:00.009247987 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     ", 
            "python  \tdefault  \t1       \t2023-01-29 22:22:01.169234597 +0300 MSK\tfailed  \tpython-0.1.0   \t1.16.0     "
        ]
    }
}
2023-01-29 22:24:26,972 p=27562 u=root n=ansible | TASK [remove python app] ****************************************************************************************************************************************************************************************************************
2023-01-29 22:24:27,275 p=27562 u=root n=ansible | changed: [localhost]
2023-01-29 22:24:27,277 p=27562 u=root n=ansible | TASK [remove db app] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:24:27,675 p=27562 u=root n=ansible | changed: [localhost]
2023-01-29 22:24:27,677 p=27562 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:24:27,677 p=27562 u=root n=ansible | localhost                  : ok=5    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2023-01-29 22:24:37,924 p=27975 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 22:24:37,933 p=27975 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 22:24:38,229 p=27975 u=root n=ansible | ok: [localhost]
2023-01-29 22:24:38,232 p=27975 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:24:38,262 p=27975 u=root n=ansible | skipping: [localhost]
2023-01-29 22:24:38,265 p=27975 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 22:24:38,294 p=27975 u=root n=ansible | skipping: [localhost]
2023-01-29 22:24:38,297 p=27975 u=root n=ansible | TASK [install ingres-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:24:39,019 p=27975 u=root n=ansible | changed: [localhost]
2023-01-29 22:24:39,022 p=27975 u=root n=ansible | TASK [install postgres] *****************************************************************************************************************************************************************************************************************
2023-01-29 22:24:40,673 p=27975 u=root n=ansible | changed: [localhost]
2023-01-29 22:24:40,677 p=27975 u=root n=ansible | TASK [install python app] ***************************************************************************************************************************************************************************************************************
2023-01-29 22:24:42,816 p=27975 u=root n=ansible | fatal: [localhost]: FAILED! => {"changed": true, "cmd": "helm install python pythweb/", "delta": "0:00:02.010142", "end": "2023-01-29 22:24:42.801618", "msg": "non-zero return code", "rc": 1, "start": "2023-01-29 22:24:40.791476", "stderr": "Error: INSTALLATION FAILED: Internal error occurred: failed calling webhook \"validate.nginx.ingress.kubernetes.io\": failed to call webhook: Post \"https://ingress-nginx-controller-admission.ingress-nginx.svc:443/networking/v1/ingresses?timeout=10s\": dial tcp 10.100.252.160:443: connect: connection refused", "stderr_lines": ["Error: INSTALLATION FAILED: Internal error occurred: failed calling webhook \"validate.nginx.ingress.kubernetes.io\": failed to call webhook: Post \"https://ingress-nginx-controller-admission.ingress-nginx.svc:443/networking/v1/ingresses?timeout=10s\": dial tcp 10.100.252.160:443: connect: connection refused"], "stdout": "", "stdout_lines": []}
2023-01-29 22:24:42,819 p=27975 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:24:42,819 p=27975 u=root n=ansible | localhost                  : ok=3    changed=2    unreachable=0    failed=1    skipped=2    rescued=0    ignored=0   
2023-01-29 22:25:00,334 p=28501 u=root n=ansible | PLAY [Remove web-app and db  from k8s] **************************************************************************************************************************************************************************************************
2023-01-29 22:25:00,343 p=28501 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:25:13,066 p=28501 u=root n=ansible | changed: [localhost]
2023-01-29 22:25:13,070 p=28501 u=root n=ansible | TASK [Check installed charts] ***********************************************************************************************************************************************************************************************************
2023-01-29 22:25:13,275 p=28501 u=root n=ansible | ok: [localhost]
2023-01-29 22:25:13,278 p=28501 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:25:13,307 p=28501 u=root n=ansible | ok: [localhost] => {
    "helm_list": {
        "changed": false, 
        "cmd": "helm list", 
        "delta": "0:00:00.032935", 
        "end": "2023-01-29 22:25:13.259534", 
        "failed": false, 
        "failed_when_result": false, 
        "rc": 0, 
        "start": "2023-01-29 22:25:13.226599", 
        "stderr": "", 
        "stderr_lines": [], 
        "stdout": "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION\npostgres\tdefault  \t1       \t2023-01-29 22:24:39.185087282 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     \npython  \tdefault  \t1       \t2023-01-29 22:24:41.33992659 +0300 MSK \tfailed  \tpython-0.1.0   \t1.16.0     ", 
        "stdout_lines": [
            "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION", 
            "postgres\tdefault  \t1       \t2023-01-29 22:24:39.185087282 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     ", 
            "python  \tdefault  \t1       \t2023-01-29 22:24:41.33992659 +0300 MSK \tfailed  \tpython-0.1.0   \t1.16.0     "
        ]
    }
}
2023-01-29 22:25:13,310 p=28501 u=root n=ansible | TASK [remove python app] ****************************************************************************************************************************************************************************************************************
2023-01-29 22:25:13,626 p=28501 u=root n=ansible | changed: [localhost]
2023-01-29 22:25:13,629 p=28501 u=root n=ansible | TASK [remove db app] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:25:14,070 p=28501 u=root n=ansible | changed: [localhost]
2023-01-29 22:25:14,072 p=28501 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:25:14,072 p=28501 u=root n=ansible | localhost                  : ok=5    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2023-01-29 22:25:27,227 p=28915 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 22:25:27,238 p=28915 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 22:25:27,518 p=28915 u=root n=ansible | ok: [localhost]
2023-01-29 22:25:27,522 p=28915 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:25:27,555 p=28915 u=root n=ansible | skipping: [localhost]
2023-01-29 22:25:27,559 p=28915 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 22:25:27,590 p=28915 u=root n=ansible | skipping: [localhost]
2023-01-29 22:25:27,593 p=28915 u=root n=ansible | TASK [install ingres-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:25:28,179 p=28915 u=root n=ansible | changed: [localhost]
2023-01-29 22:25:28,181 p=28915 u=root n=ansible | TASK [install postgres] *****************************************************************************************************************************************************************************************************************
2023-01-29 22:25:29,128 p=28915 u=root n=ansible | changed: [localhost]
2023-01-29 22:25:29,131 p=28915 u=root n=ansible | TASK [install python app] ***************************************************************************************************************************************************************************************************************
2023-01-29 22:25:29,251 p=28915 u=root n=ansible | fatal: [localhost]: FAILED! => {"changed": false, "msg": "Unsupported parameters for (command) module: delay, retries Supported parameters include: _raw_params, _uses_shell, argv, chdir, creates, executable, removes, stdin, stdin_add_newline, strip_empty_ends, warn"}
2023-01-29 22:25:29,252 p=28915 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:25:29,253 p=28915 u=root n=ansible | localhost                  : ok=3    changed=2    unreachable=0    failed=1    skipped=2    rescued=0    ignored=0   
2023-01-29 22:25:43,052 p=29254 u=root n=ansible | PLAY [Remove web-app and db  from k8s] **************************************************************************************************************************************************************************************************
2023-01-29 22:25:43,063 p=29254 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:25:55,086 p=29254 u=root n=ansible | changed: [localhost]
2023-01-29 22:25:55,089 p=29254 u=root n=ansible | TASK [Check installed charts] ***********************************************************************************************************************************************************************************************************
2023-01-29 22:25:55,304 p=29254 u=root n=ansible | ok: [localhost]
2023-01-29 22:25:55,307 p=29254 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:25:55,340 p=29254 u=root n=ansible | ok: [localhost] => {
    "helm_list": {
        "changed": false, 
        "cmd": "helm list", 
        "delta": "0:00:00.031607", 
        "end": "2023-01-29 22:25:55.288188", 
        "failed": false, 
        "failed_when_result": false, 
        "rc": 0, 
        "start": "2023-01-29 22:25:55.256581", 
        "stderr": "", 
        "stderr_lines": [], 
        "stdout": "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION\npostgres\tdefault  \t1       \t2023-01-29 22:25:28.332711886 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     ", 
        "stdout_lines": [
            "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION", 
            "postgres\tdefault  \t1       \t2023-01-29 22:25:28.332711886 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     "
        ]
    }
}
2023-01-29 22:25:55,343 p=29254 u=root n=ansible | TASK [remove python app] ****************************************************************************************************************************************************************************************************************
2023-01-29 22:25:55,371 p=29254 u=root n=ansible | skipping: [localhost]
2023-01-29 22:25:55,374 p=29254 u=root n=ansible | TASK [remove db app] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:25:55,810 p=29254 u=root n=ansible | changed: [localhost]
2023-01-29 22:25:55,811 p=29254 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:25:55,811 p=29254 u=root n=ansible | localhost                  : ok=4    changed=2    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
2023-01-29 22:26:30,820 p=29736 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 22:26:30,830 p=29736 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 22:26:31,102 p=29736 u=root n=ansible | ok: [localhost]
2023-01-29 22:26:31,106 p=29736 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:26:31,143 p=29736 u=root n=ansible | skipping: [localhost]
2023-01-29 22:26:31,146 p=29736 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 22:26:31,182 p=29736 u=root n=ansible | skipping: [localhost]
2023-01-29 22:26:31,185 p=29736 u=root n=ansible | TASK [install ingres-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:26:31,855 p=29736 u=root n=ansible | changed: [localhost]
2023-01-29 22:26:31,858 p=29736 u=root n=ansible | TASK [install postgres] *****************************************************************************************************************************************************************************************************************
2023-01-29 22:26:32,914 p=29736 u=root n=ansible | changed: [localhost]
2023-01-29 22:26:32,918 p=29736 u=root n=ansible | TASK [install python app] ***************************************************************************************************************************************************************************************************************
2023-01-29 22:26:50,650 p=29736 u=root n=ansible | fatal: [localhost]: FAILED! => {"attempts": 3, "changed": true, "cmd": "helm install python pythweb/", "delta": "0:00:00.036077", "end": "2023-01-29 22:26:50.631332", "msg": "non-zero return code", "rc": 1, "start": "2023-01-29 22:26:50.595255", "stderr": "Error: INSTALLATION FAILED: cannot re-use a name that is still in use", "stderr_lines": ["Error: INSTALLATION FAILED: cannot re-use a name that is still in use"], "stdout": "", "stdout_lines": []}
2023-01-29 22:26:50,652 p=29736 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:26:50,652 p=29736 u=root n=ansible | localhost                  : ok=3    changed=2    unreachable=0    failed=1    skipped=2    rescued=0    ignored=0   
2023-01-29 22:27:05,728 p=30375 u=root n=ansible | PLAY [Remove web-app and db  from k8s] **************************************************************************************************************************************************************************************************
2023-01-29 22:27:05,737 p=30375 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:27:18,052 p=30375 u=root n=ansible | changed: [localhost]
2023-01-29 22:27:18,054 p=30375 u=root n=ansible | TASK [Check installed charts] ***********************************************************************************************************************************************************************************************************
2023-01-29 22:27:18,261 p=30375 u=root n=ansible | ok: [localhost]
2023-01-29 22:27:18,264 p=30375 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:27:18,297 p=30375 u=root n=ansible | ok: [localhost] => {
    "helm_list": {
        "changed": false, 
        "cmd": "helm list", 
        "delta": "0:00:00.032959", 
        "end": "2023-01-29 22:27:18.242305", 
        "failed": false, 
        "failed_when_result": false, 
        "rc": 0, 
        "start": "2023-01-29 22:27:18.209346", 
        "stderr": "", 
        "stderr_lines": [], 
        "stdout": "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION\npostgres\tdefault  \t1       \t2023-01-29 22:26:32.023254967 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     \npython  \tdefault  \t1       \t2023-01-29 22:26:33.15631123 +0300 MSK \tfailed  \tpython-0.1.0   \t1.16.0     ", 
        "stdout_lines": [
            "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION", 
            "postgres\tdefault  \t1       \t2023-01-29 22:26:32.023254967 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     ", 
            "python  \tdefault  \t1       \t2023-01-29 22:26:33.15631123 +0300 MSK \tfailed  \tpython-0.1.0   \t1.16.0     "
        ]
    }
}
2023-01-29 22:27:18,299 p=30375 u=root n=ansible | TASK [remove python app] ****************************************************************************************************************************************************************************************************************
2023-01-29 22:27:18,602 p=30375 u=root n=ansible | changed: [localhost]
2023-01-29 22:27:18,605 p=30375 u=root n=ansible | TASK [remove db app] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:27:18,962 p=30375 u=root n=ansible | changed: [localhost]
2023-01-29 22:27:18,964 p=30375 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:27:18,964 p=30375 u=root n=ansible | localhost                  : ok=5    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2023-01-29 22:27:56,019 p=30904 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 22:27:56,030 p=30904 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 22:27:56,320 p=30904 u=root n=ansible | ok: [localhost]
2023-01-29 22:27:56,325 p=30904 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:27:56,353 p=30904 u=root n=ansible | skipping: [localhost]
2023-01-29 22:27:56,356 p=30904 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 22:27:56,384 p=30904 u=root n=ansible | skipping: [localhost]
2023-01-29 22:27:56,387 p=30904 u=root n=ansible | TASK [install ingres-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:27:56,976 p=30904 u=root n=ansible | changed: [localhost]
2023-01-29 22:27:56,978 p=30904 u=root n=ansible | TASK [install postgres] *****************************************************************************************************************************************************************************************************************
2023-01-29 22:27:57,874 p=30904 u=root n=ansible | changed: [localhost]
2023-01-29 22:27:57,876 p=30904 u=root n=ansible | TASK [install python app] ***************************************************************************************************************************************************************************************************************
2023-01-29 22:28:15,246 p=30904 u=root n=ansible | fatal: [localhost]: FAILED! => {"attempts": 3, "changed": true, "cmd": "helm install python pythweb/", "delta": "0:00:00.035766", "end": "2023-01-29 22:28:15.229546", "msg": "non-zero return code", "rc": 1, "start": "2023-01-29 22:28:15.193780", "stderr": "Error: INSTALLATION FAILED: cannot re-use a name that is still in use", "stderr_lines": ["Error: INSTALLATION FAILED: cannot re-use a name that is still in use"], "stdout": "", "stdout_lines": []}
2023-01-29 22:28:15,247 p=30904 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:28:15,247 p=30904 u=root n=ansible | localhost                  : ok=3    changed=2    unreachable=0    failed=1    skipped=2    rescued=0    ignored=0   
2023-01-29 22:28:22,596 p=31507 u=root n=ansible | PLAY [Remove web-app and db  from k8s] **************************************************************************************************************************************************************************************************
2023-01-29 22:28:22,605 p=31507 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:28:34,869 p=31507 u=root n=ansible | changed: [localhost]
2023-01-29 22:28:34,872 p=31507 u=root n=ansible | TASK [Check installed charts] ***********************************************************************************************************************************************************************************************************
2023-01-29 22:28:35,103 p=31507 u=root n=ansible | ok: [localhost]
2023-01-29 22:28:35,108 p=31507 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:28:35,141 p=31507 u=root n=ansible | ok: [localhost] => {
    "helm_list": {
        "changed": false, 
        "cmd": "helm list", 
        "delta": "0:00:00.033272", 
        "end": "2023-01-29 22:28:35.088353", 
        "failed": false, 
        "failed_when_result": false, 
        "rc": 0, 
        "start": "2023-01-29 22:28:35.055081", 
        "stderr": "", 
        "stderr_lines": [], 
        "stdout": "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION\npostgres\tdefault  \t1       \t2023-01-29 22:27:57.136141786 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     \npython  \tdefault  \t1       \t2023-01-29 22:27:58.431592927 +0300 MSK\tfailed  \tpython-0.1.0   \t1.16.0     ", 
        "stdout_lines": [
            "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION", 
            "postgres\tdefault  \t1       \t2023-01-29 22:27:57.136141786 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     ", 
            "python  \tdefault  \t1       \t2023-01-29 22:27:58.431592927 +0300 MSK\tfailed  \tpython-0.1.0   \t1.16.0     "
        ]
    }
}
2023-01-29 22:28:35,144 p=31507 u=root n=ansible | TASK [remove python app] ****************************************************************************************************************************************************************************************************************
2023-01-29 22:28:35,472 p=31507 u=root n=ansible | changed: [localhost]
2023-01-29 22:28:35,475 p=31507 u=root n=ansible | TASK [remove db app] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:28:35,868 p=31507 u=root n=ansible | changed: [localhost]
2023-01-29 22:28:35,870 p=31507 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:28:35,870 p=31507 u=root n=ansible | localhost                  : ok=5    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2023-01-29 22:28:39,983 p=31888 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 22:28:39,992 p=31888 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 22:28:40,304 p=31888 u=root n=ansible | ok: [localhost]
2023-01-29 22:28:40,308 p=31888 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:28:40,340 p=31888 u=root n=ansible | skipping: [localhost]
2023-01-29 22:28:40,344 p=31888 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 22:28:40,374 p=31888 u=root n=ansible | skipping: [localhost]
2023-01-29 22:28:40,376 p=31888 u=root n=ansible | TASK [install ingres-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:28:41,057 p=31888 u=root n=ansible | changed: [localhost]
2023-01-29 22:28:41,059 p=31888 u=root n=ansible | TASK [install postgres] *****************************************************************************************************************************************************************************************************************
2023-01-29 22:28:41,833 p=31888 u=root n=ansible | changed: [localhost]
2023-01-29 22:28:41,835 p=31888 u=root n=ansible | TASK [install python app] ***************************************************************************************************************************************************************************************************************
2023-01-29 22:28:43,769 p=31888 u=root n=ansible | fatal: [localhost]: FAILED! => {"changed": true, "cmd": "helm install python pythweb/", "delta": "0:00:01.783877", "end": "2023-01-29 22:28:43.728574", "msg": "non-zero return code", "rc": 1, "start": "2023-01-29 22:28:41.944697", "stderr": "Error: INSTALLATION FAILED: Internal error occurred: failed calling webhook \"validate.nginx.ingress.kubernetes.io\": failed to call webhook: Post \"https://ingress-nginx-controller-admission.ingress-nginx.svc:443/networking/v1/ingresses?timeout=10s\": dial tcp 10.96.5.135:443: connect: connection refused", "stderr_lines": ["Error: INSTALLATION FAILED: Internal error occurred: failed calling webhook \"validate.nginx.ingress.kubernetes.io\": failed to call webhook: Post \"https://ingress-nginx-controller-admission.ingress-nginx.svc:443/networking/v1/ingresses?timeout=10s\": dial tcp 10.96.5.135:443: connect: connection refused"], "stdout": "", "stdout_lines": []}
2023-01-29 22:28:43,770 p=31888 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:28:43,770 p=31888 u=root n=ansible | localhost                  : ok=3    changed=2    unreachable=0    failed=1    skipped=2    rescued=0    ignored=0   
2023-01-29 22:32:51,398 p=1030 u=root n=ansible | PLAY [Remove web-app and db  from k8s] **************************************************************************************************************************************************************************************************
2023-01-29 22:32:51,407 p=1030 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:33:03,476 p=1030 u=root n=ansible | changed: [localhost]
2023-01-29 22:33:03,480 p=1030 u=root n=ansible | TASK [Check installed charts] ***********************************************************************************************************************************************************************************************************
2023-01-29 22:33:03,699 p=1030 u=root n=ansible | ok: [localhost]
2023-01-29 22:33:03,702 p=1030 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:33:03,735 p=1030 u=root n=ansible | ok: [localhost] => {
    "helm_list": {
        "changed": false, 
        "cmd": "helm list", 
        "delta": "0:00:00.038411", 
        "end": "2023-01-29 22:33:03.683639", 
        "failed": false, 
        "failed_when_result": false, 
        "rc": 0, 
        "start": "2023-01-29 22:33:03.645228", 
        "stderr": "", 
        "stderr_lines": [], 
        "stdout": "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION\npostgres\tdefault  \t1       \t2023-01-29 22:28:41.236290155 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     \npython  \tdefault  \t1       \t2023-01-29 22:28:42.020270419 +0300 MSK\tfailed  \tpython-0.1.0   \t1.16.0     ", 
        "stdout_lines": [
            "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION", 
            "postgres\tdefault  \t1       \t2023-01-29 22:28:41.236290155 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     ", 
            "python  \tdefault  \t1       \t2023-01-29 22:28:42.020270419 +0300 MSK\tfailed  \tpython-0.1.0   \t1.16.0     "
        ]
    }
}
2023-01-29 22:33:03,738 p=1030 u=root n=ansible | TASK [remove python app] ****************************************************************************************************************************************************************************************************************
2023-01-29 22:33:04,105 p=1030 u=root n=ansible | changed: [localhost]
2023-01-29 22:33:04,107 p=1030 u=root n=ansible | TASK [remove db app] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:33:04,497 p=1030 u=root n=ansible | changed: [localhost]
2023-01-29 22:33:04,498 p=1030 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:33:04,499 p=1030 u=root n=ansible | localhost                  : ok=5    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2023-01-29 22:33:11,747 p=1380 u=root n=ansible | ERROR! We were unable to read either as JSON nor YAML, these are the errors we got from each:
JSON: No JSON object could be decoded

Syntax Error while loading YAML.
  did not find expected key

The error appears to be in '/opt/helm/charts/deploy_app.yml': line 46, column 7, but may
be elsewhere in the file depending on the exact syntax problem.

The offending line appears to be:


      - name: test
      ^ here

2023-01-29 22:33:22,090 p=1478 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 22:33:22,100 p=1478 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 22:33:22,398 p=1478 u=root n=ansible | ok: [localhost]
2023-01-29 22:33:22,402 p=1478 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:33:22,433 p=1478 u=root n=ansible | skipping: [localhost]
2023-01-29 22:33:22,435 p=1478 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 22:33:22,469 p=1478 u=root n=ansible | skipping: [localhost]
2023-01-29 22:33:22,472 p=1478 u=root n=ansible | TASK [install ingres-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:33:23,204 p=1478 u=root n=ansible | changed: [localhost]
2023-01-29 22:33:23,207 p=1478 u=root n=ansible | TASK [install postgres] *****************************************************************************************************************************************************************************************************************
2023-01-29 22:33:24,784 p=1478 u=root n=ansible | changed: [localhost]
2023-01-29 22:33:24,786 p=1478 u=root n=ansible | TASK [install python app] ***************************************************************************************************************************************************************************************************************
2023-01-29 22:33:41,755 p=1478 u=root n=ansible | fatal: [localhost]: FAILED! => {"attempts": 3, "changed": true, "cmd": "helm install python pythweb/", "delta": "0:00:00.034497", "end": "2023-01-29 22:33:41.738928", "msg": "non-zero return code", "rc": 1, "start": "2023-01-29 22:33:41.704431", "stderr": "Error: INSTALLATION FAILED: cannot re-use a name that is still in use", "stderr_lines": ["Error: INSTALLATION FAILED: cannot re-use a name that is still in use"], "stdout": "", "stdout_lines": []}
2023-01-29 22:33:41,757 p=1478 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:33:41,757 p=1478 u=root n=ansible | localhost                  : ok=3    changed=2    unreachable=0    failed=1    skipped=2    rescued=0    ignored=0   
2023-01-29 22:34:12,481 p=2256 u=root n=ansible | PLAY [Remove web-app and db  from k8s] **************************************************************************************************************************************************************************************************
2023-01-29 22:34:12,489 p=2256 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:34:24,661 p=2256 u=root n=ansible | changed: [localhost]
2023-01-29 22:34:24,664 p=2256 u=root n=ansible | TASK [Check installed charts] ***********************************************************************************************************************************************************************************************************
2023-01-29 22:34:24,897 p=2256 u=root n=ansible | ok: [localhost]
2023-01-29 22:34:24,900 p=2256 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:34:24,930 p=2256 u=root n=ansible | ok: [localhost] => {
    "helm_list": {
        "changed": false, 
        "cmd": "helm list", 
        "delta": "0:00:00.034111", 
        "end": "2023-01-29 22:34:24.882964", 
        "failed": false, 
        "failed_when_result": false, 
        "rc": 0, 
        "start": "2023-01-29 22:34:24.848853", 
        "stderr": "", 
        "stderr_lines": [], 
        "stdout": "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION\npostgres\tdefault  \t1       \t2023-01-29 22:33:23.397956134 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     \npython  \tdefault  \t1       \t2023-01-29 22:33:25.076569422 +0300 MSK\tfailed  \tpython-0.1.0   \t1.16.0     ", 
        "stdout_lines": [
            "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION", 
            "postgres\tdefault  \t1       \t2023-01-29 22:33:23.397956134 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     ", 
            "python  \tdefault  \t1       \t2023-01-29 22:33:25.076569422 +0300 MSK\tfailed  \tpython-0.1.0   \t1.16.0     "
        ]
    }
}
2023-01-29 22:34:24,933 p=2256 u=root n=ansible | TASK [remove python app] ****************************************************************************************************************************************************************************************************************
2023-01-29 22:34:25,257 p=2256 u=root n=ansible | changed: [localhost]
2023-01-29 22:34:25,260 p=2256 u=root n=ansible | TASK [remove db app] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:34:25,574 p=2256 u=root n=ansible | changed: [localhost]
2023-01-29 22:34:25,576 p=2256 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:34:25,576 p=2256 u=root n=ansible | localhost                  : ok=5    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2023-01-29 22:34:29,319 p=2649 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 22:34:29,329 p=2649 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 22:34:29,595 p=2649 u=root n=ansible | ok: [localhost]
2023-01-29 22:34:29,598 p=2649 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:34:29,631 p=2649 u=root n=ansible | skipping: [localhost]
2023-01-29 22:34:29,634 p=2649 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 22:34:29,663 p=2649 u=root n=ansible | skipping: [localhost]
2023-01-29 22:34:29,666 p=2649 u=root n=ansible | TASK [install ingres-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:34:30,223 p=2649 u=root n=ansible | changed: [localhost]
2023-01-29 22:34:30,226 p=2649 u=root n=ansible | TASK [install postgres] *****************************************************************************************************************************************************************************************************************
2023-01-29 22:34:31,889 p=2649 u=root n=ansible | changed: [localhost]
2023-01-29 22:34:31,892 p=2649 u=root n=ansible | TASK [install python app] ***************************************************************************************************************************************************************************************************************
2023-01-29 22:34:37,531 p=2649 u=root n=ansible |  [ERROR]: User interrupted execution

2023-01-29 22:34:41,120 p=3052 u=root n=ansible | PLAY [Remove web-app and db  from k8s] **************************************************************************************************************************************************************************************************
2023-01-29 22:34:41,129 p=3052 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:34:53,173 p=3052 u=root n=ansible | changed: [localhost]
2023-01-29 22:34:53,178 p=3052 u=root n=ansible | TASK [Check installed charts] ***********************************************************************************************************************************************************************************************************
2023-01-29 22:34:53,379 p=3052 u=root n=ansible | ok: [localhost]
2023-01-29 22:34:53,382 p=3052 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:34:53,413 p=3052 u=root n=ansible | ok: [localhost] => {
    "helm_list": {
        "changed": false, 
        "cmd": "helm list", 
        "delta": "0:00:00.032928", 
        "end": "2023-01-29 22:34:53.363928", 
        "failed": false, 
        "failed_when_result": false, 
        "rc": 0, 
        "start": "2023-01-29 22:34:53.331000", 
        "stderr": "", 
        "stderr_lines": [], 
        "stdout": "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION\npostgres\tdefault  \t1       \t2023-01-29 22:34:30.373253018 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     \npython  \tdefault  \t1       \t2023-01-29 22:34:32.069585016 +0300 MSK\tfailed  \tpython-0.1.0   \t1.16.0     ", 
        "stdout_lines": [
            "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION", 
            "postgres\tdefault  \t1       \t2023-01-29 22:34:30.373253018 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     ", 
            "python  \tdefault  \t1       \t2023-01-29 22:34:32.069585016 +0300 MSK\tfailed  \tpython-0.1.0   \t1.16.0     "
        ]
    }
}
2023-01-29 22:34:53,416 p=3052 u=root n=ansible | TASK [remove python app] ****************************************************************************************************************************************************************************************************************
2023-01-29 22:34:53,692 p=3052 u=root n=ansible | changed: [localhost]
2023-01-29 22:34:53,695 p=3052 u=root n=ansible | TASK [remove db app] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:34:54,088 p=3052 u=root n=ansible | changed: [localhost]
2023-01-29 22:34:54,090 p=3052 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:34:54,090 p=3052 u=root n=ansible | localhost                  : ok=5    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2023-01-29 22:34:57,754 p=3406 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 22:34:57,763 p=3406 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 22:34:58,031 p=3406 u=root n=ansible | ok: [localhost]
2023-01-29 22:34:58,034 p=3406 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:34:58,062 p=3406 u=root n=ansible | skipping: [localhost]
2023-01-29 22:34:58,065 p=3406 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 22:34:58,093 p=3406 u=root n=ansible | skipping: [localhost]
2023-01-29 22:34:58,096 p=3406 u=root n=ansible | TASK [install ingres-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:34:58,652 p=3406 u=root n=ansible | changed: [localhost]
2023-01-29 22:34:58,654 p=3406 u=root n=ansible | TASK [install postgres] *****************************************************************************************************************************************************************************************************************
2023-01-29 22:34:59,577 p=3406 u=root n=ansible | changed: [localhost]
2023-01-29 22:34:59,580 p=3406 u=root n=ansible | TASK [install python app] ***************************************************************************************************************************************************************************************************************
2023-01-29 22:35:01,615 p=3406 u=root n=ansible | changed: [localhost]
2023-01-29 22:35:01,619 p=3406 u=root n=ansible | TASK [test] *****************************************************************************************************************************************************************************************************************************
2023-01-29 22:35:01,652 p=3406 u=root n=ansible | ok: [localhost] => {
    "result": {
        "attempts": 1, 
        "changed": true, 
        "cmd": "helm install python pythweb/", 
        "delta": "0:00:01.831257", 
        "end": "2023-01-29 22:35:01.579856", 
        "failed": false, 
        "failed_when_result": false, 
        "msg": "non-zero return code", 
        "rc": 1, 
        "start": "2023-01-29 22:34:59.748599", 
        "stderr": "Error: INSTALLATION FAILED: Internal error occurred: failed calling webhook \"validate.nginx.ingress.kubernetes.io\": failed to call webhook: Post \"https://ingress-nginx-controller-admission.ingress-nginx.svc:443/networking/v1/ingresses?timeout=10s\": dial tcp 10.103.55.105:443: connect: connection refused", 
        "stderr_lines": [
            "Error: INSTALLATION FAILED: Internal error occurred: failed calling webhook \"validate.nginx.ingress.kubernetes.io\": failed to call webhook: Post \"https://ingress-nginx-controller-admission.ingress-nginx.svc:443/networking/v1/ingresses?timeout=10s\": dial tcp 10.103.55.105:443: connect: connection refused"
        ], 
        "stdout": "", 
        "stdout_lines": []
    }
}
2023-01-29 22:35:01,654 p=3406 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:35:01,654 p=3406 u=root n=ansible | localhost                  : ok=5    changed=3    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   
2023-01-29 22:38:30,074 p=4649 u=root n=ansible | PLAY [Remove web-app and db  from k8s] **************************************************************************************************************************************************************************************************
2023-01-29 22:38:30,084 p=4649 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:38:41,943 p=4649 u=root n=ansible | changed: [localhost]
2023-01-29 22:38:41,946 p=4649 u=root n=ansible | TASK [Check installed charts] ***********************************************************************************************************************************************************************************************************
2023-01-29 22:38:42,148 p=4649 u=root n=ansible | ok: [localhost]
2023-01-29 22:38:42,151 p=4649 u=root n=ansible | TASK [remove ingress-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:38:42,181 p=4649 u=root n=ansible | ok: [localhost] => {
    "helm_list": {
        "changed": false, 
        "cmd": "helm list", 
        "delta": "0:00:00.033213", 
        "end": "2023-01-29 22:38:42.135454", 
        "failed": false, 
        "failed_when_result": false, 
        "rc": 0, 
        "start": "2023-01-29 22:38:42.102241", 
        "stderr": "", 
        "stderr_lines": [], 
        "stdout": "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION\npostgres\tdefault  \t1       \t2023-01-29 22:34:58.803615978 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     \npython  \tdefault  \t1       \t2023-01-29 22:34:59.902032586 +0300 MSK\tfailed  \tpython-0.1.0   \t1.16.0     ", 
        "stdout_lines": [
            "NAME    \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART          \tAPP VERSION", 
            "postgres\tdefault  \t1       \t2023-01-29 22:34:58.803615978 +0300 MSK\tdeployed\tpostgresql-15.1\t15.1.0     ", 
            "python  \tdefault  \t1       \t2023-01-29 22:34:59.902032586 +0300 MSK\tfailed  \tpython-0.1.0   \t1.16.0     "
        ]
    }
}
2023-01-29 22:38:42,184 p=4649 u=root n=ansible | TASK [remove python app] ****************************************************************************************************************************************************************************************************************
2023-01-29 22:38:42,498 p=4649 u=root n=ansible | changed: [localhost]
2023-01-29 22:38:42,501 p=4649 u=root n=ansible | TASK [remove db app] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:38:42,818 p=4649 u=root n=ansible | changed: [localhost]
2023-01-29 22:38:42,820 p=4649 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:38:42,820 p=4649 u=root n=ansible | localhost                  : ok=5    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2023-01-29 22:38:46,371 p=4985 u=root n=ansible | PLAY [Install web-app and db to k8s] ****************************************************************************************************************************************************************************************************
2023-01-29 22:38:46,380 p=4985 u=root n=ansible | TASK [Check helm] ***********************************************************************************************************************************************************************************************************************
2023-01-29 22:38:46,642 p=4985 u=root n=ansible | ok: [localhost]
2023-01-29 22:38:46,645 p=4985 u=root n=ansible | TASK [Download helm] ********************************************************************************************************************************************************************************************************************
2023-01-29 22:38:46,675 p=4985 u=root n=ansible | skipping: [localhost]
2023-01-29 22:38:46,677 p=4985 u=root n=ansible | TASK [install helm] *********************************************************************************************************************************************************************************************************************
2023-01-29 22:38:46,705 p=4985 u=root n=ansible | skipping: [localhost]
2023-01-29 22:38:46,708 p=4985 u=root n=ansible | TASK [install ingres-controller] ********************************************************************************************************************************************************************************************************
2023-01-29 22:38:47,488 p=4985 u=root n=ansible | changed: [localhost]
2023-01-29 22:38:47,491 p=4985 u=root n=ansible | TASK [install postgres] *****************************************************************************************************************************************************************************************************************
2023-01-29 22:38:47,830 p=4985 u=root n=ansible | changed: [localhost]
2023-01-29 22:38:47,833 p=4985 u=root n=ansible | TASK [Pause for 30 sec to up ingress-controller] ****************************************************************************************************************************************************************************************
2023-01-29 22:38:47,843 p=5105 u=root n=ansible | Pausing for 30 seconds
2023-01-29 22:38:47,843 p=5105 u=root n=ansible | (ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
2023-01-29 22:39:17,846 p=4985 u=root n=ansible | ok: [localhost]
2023-01-29 22:39:17,849 p=4985 u=root n=ansible | TASK [install python app] ***************************************************************************************************************************************************************************************************************
2023-01-29 22:39:18,180 p=4985 u=root n=ansible | changed: [localhost]
2023-01-29 22:39:18,181 p=4985 u=root n=ansible | PLAY RECAP ******************************************************************************************************************************************************************************************************************************
2023-01-29 22:39:18,182 p=4985 u=root n=ansible | localhost                  : ok=5    changed=3    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   
